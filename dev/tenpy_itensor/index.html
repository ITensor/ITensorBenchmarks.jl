<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>TeNPy and ITensor Comparisons · ITensorsBenchmarks</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">ITensorsBenchmarks</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Introduction</a></li><li class="is-active"><a class="tocitem" href="index.html">TeNPy and ITensor Comparisons</a><ul class="internal"><li><a class="tocitem" href="#Setup-of-the-Two-Codes-and-Baseline-Comparisons"><span>Setup of the Two Codes and Baseline Comparisons</span></a></li><li><a class="tocitem" href="#Dense-DMRG-Comparison"><span>Dense DMRG Comparison</span></a></li><li><a class="tocitem" href="#QN-Block-Sparse-DMRG-Comparison"><span>QN Block Sparse DMRG Comparison</span></a></li><li><a class="tocitem" href="#QN-Block-Sparse-DMRG,-With-Sparse-MPO,-Comparison"><span>QN Block Sparse DMRG, With Sparse MPO, Comparison</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="index.html">TeNPy and ITensor Comparisons</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">TeNPy and ITensor Comparisons</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ITensor/ITensorsBenchmarks.jl/blob/master/docs/src/tenpy_itensor/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="TeNPy-and-ITensor-Comparisons"><a class="docs-heading-anchor" href="#TeNPy-and-ITensor-Comparisons">TeNPy and ITensor Comparisons</a><a id="TeNPy-and-ITensor-Comparisons-1"></a><a class="docs-heading-anchor-permalink" href="#TeNPy-and-ITensor-Comparisons" title="Permalink"></a></h1><p>To properly put the performance of ITensor into context, it is important to compare to state-of-the-art tensor network software, implementing methods such as the density matrix renormalization group (DMRG). One leading software package for tensor networks is TeNPy, which offers a rich Python interface as well as components implemented in C/C++ for maximum performance.<sup class="footnote-reference"><a id="citeref-TeNPy" href="#footnote-TeNPy">[TeNPy]</a></sup> The code for TeNPy is available at <a href="https://github.com/tenpy/tenpy">https://github.com/tenpy/tenpy</a>. We thank TeNPY developer Johannes Hauschild for devoting significant time in helping us prepare these comparisons. </p><p>Here we will be interested in comparing the performance of the Julia version of ITensor<sup class="footnote-reference"><a id="citeref-ITensor" href="#footnote-ITensor">[ITensor]</a></sup> to TeNPy.</p><h2 id="Setup-of-the-Two-Codes-and-Baseline-Comparisons"><a class="docs-heading-anchor" href="#Setup-of-the-Two-Codes-and-Baseline-Comparisons">Setup of the Two Codes and Baseline Comparisons</a><a id="Setup-of-the-Two-Codes-and-Baseline-Comparisons-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-of-the-Two-Codes-and-Baseline-Comparisons" title="Permalink"></a></h2><p>To make the comparisons meaningful, we first checked that the BLAS GEMM matrix-matrix multiplication performance was the same in both our Julia and Python configurations. For this purpose we used a custom Python configuration which uses the Intel MKL implementations of BLAS and LAPACK. Other important checks included stepping through details of the DMRG codes used in both libraries, to check for example that the number of Lanczos steps performed at the core of each DMRG implementation was the same, and that similar truncation parameters resulted in similar MPS bond dimensi</p><p>All benchmarks were carried out on a single workstation with four Intel Xeon Gold 6128 (Skylake) 3.4 GHz CPUs with six cores each. Times shown are &quot;wall&quot; or actual time, not CPU time. The BLAS and LAPACK distribution used for the C++, Julia, and Python calculations was Intel MKL. For the Julia ITensor benchmarks we used version 0.2.0 of ITensors.jl running on Julia version 1.6.1. For the TeNPy benchmark results we used TeNPy version 0.8.4. The benchmarks presented below have been made publicly available at: <a href="https://github.com/ITensor/ITensorsBenchmarks.jl">https://github.com/ITensor/ITensorsBenchmarks.jl</a>.</p><h2 id="Dense-DMRG-Comparison"><a class="docs-heading-anchor" href="#Dense-DMRG-Comparison">Dense DMRG Comparison</a><a id="Dense-DMRG-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#Dense-DMRG-Comparison" title="Permalink"></a></h2><p>First we show results for DMRG calculations not conserving any quantum numbers so that all tensors are dense. The system used was the one-dimensional Heisenberg model of one hundred <span>$S=1$</span> spins:</p><p><img src="tenpy_dmrg_1d_compare.png" alt/></p><p>From the results we see that both codes give identical scaling behavior with the bond dimension used, though overall the ITensor is faster by about <span>$10\%$</span> for the larger bond dimensions. The relative speedup of ITensor over TeNPy for this case goes down with increasing bond dimension–-as expected since eventually the calculations become dominated by BLAS operations–-indicating that the performance gap is due only to operations with sub-leading scaling behavior. It is notable for this case that using BLAS multithreading gives a significant speedup.</p><h2 id="QN-Block-Sparse-DMRG-Comparison"><a class="docs-heading-anchor" href="#QN-Block-Sparse-DMRG-Comparison">QN Block Sparse DMRG Comparison</a><a id="QN-Block-Sparse-DMRG-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#QN-Block-Sparse-DMRG-Comparison" title="Permalink"></a></h2><p>Next we benchmark DMRG calculations for the same system but now conserving the total <span>$S^z$</span> spin quantum number, resulting in block-sparse tensors. For this case TeNPy takes advantage by default of a sparse representation of the MPO tensor network used to represent the Hamiltonian. This sparse MPO turns out to be quite advantageous, but is currently not the default MPO format used by ITensor. So when making the comparisons we compare calculation times with both codes either making (1) the MPO as dense as possible (while still conserving total <span>$S^z$</span>) and (2) the MPO as sparse as possible. </p><p>First when making the MPO as dense as possible, we find the following calculation times:</p><p><img src="tenpy_dmrg_1d_qn_densempo.png" alt/></p><p>Here the performance of both libraries is remarkably similar, which reassuringly implies that neither library is incurring major inefficiencies. TeNPy performs slightly better in this case for the case of a multithreaded BLAS. But compared to the fully dense tensor case, we see that BLAS multithreading is less effective for the reasons discussed in the previous section.</p><h2 id="QN-Block-Sparse-DMRG,-With-Sparse-MPO,-Comparison"><a class="docs-heading-anchor" href="#QN-Block-Sparse-DMRG,-With-Sparse-MPO,-Comparison">QN Block Sparse DMRG, With Sparse MPO, Comparison</a><a id="QN-Block-Sparse-DMRG,-With-Sparse-MPO,-Comparison-1"></a><a class="docs-heading-anchor-permalink" href="#QN-Block-Sparse-DMRG,-With-Sparse-MPO,-Comparison" title="Permalink"></a></h2><p>Finally, we benchmark block-sparse DMRG calculations with the Hamiltonian MPO taken to be as sparse as possible. This can be accomplished in ITensor by calling  <code>H = splitblocks(linkinds, H)</code> on the MPO before starting the DMRG calculation, and is the <strong>default</strong> behavior of TeNPy. </p><p><img src="tenpy_dmrg_1d_qn_sparsecompare.png" alt/></p><p>By comparing to the previous results, we can see that making the MPO as sparse as possible speeds up both codes significantly, with the ITensor implementation now outperforming TeNPy by about <span>$10\%$</span> for the largest bond dimension studied. We believe the reason for this difference is that, based on recent optimizations we have performed that significantly improved the above results, the latest version of ITensor now has rather low overhead in managing the extra details and side computations required for block-sparse tensor operations.  Another conclusion from the above study is that the significantly better performance obtained from a maximally sparse MPO suggests it would be good default setting for ITensor going forward.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-TeNPy"><a class="tag is-link" href="#citeref-TeNPy">TeNPy</a><a href="https://scipost.org/10.21468/SciPostPhysLectNotes.5">&quot;Efficient numerical simulations with Tensor Networks: Tensor Network Python (TeNPy)&quot;</a>, Johannes Hauschild, Frank Pollmann, <em>SciPost Phys. Lect. Notes</em> <strong>5</strong> (2018) <a href="https://scipost.org/10.21468/SciPostPhysLectNotes.5">10.21468/SciPostPhysLectNotes.5</a> </li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../index.html">« Introduction</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.4 on <span class="colophon-date" title="Thursday 22 July 2021 00:49">Thursday 22 July 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
